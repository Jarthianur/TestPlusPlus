language: cpp
install: true

matrix:
  include:

  - name: "Linux (gcc)"
    os: linux
    dist: trusty
    sudo: required
    compiler:
    - gcc
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - python-pip
        - g++-8
    install:
    - export CXX=g++-8
    - export GCOV=gcov-8
    - wget -q https://github.com/linux-test-project/lcov/releases/download/v1.14/lcov-1.14.tar.gz
    - tar xf lcov-1.14.tar.gz
    - export LCOV="$PWD/lcov-1.14/bin/lcov --gcov-tool=/usr/bin/$GCOV"
    - $LCOV --version
    - $GCOV --version
    - $CXX --version
    - sudo pip install --upgrade pip
    - sudo pip install spline
    - mkdir reports
    script:
    - spline --tags=linux
    after_success:
    - bash <(curl -s https://codecov.io/bash) -x $GCOV -s reports/ -X gcov

  - name: "OSX (clang)"
    os: osx
    osx_image: xcode10.2
    sudo: required
    compiler:
    - clang
    install:
    - brew install libomp
    - clang++ --version
    - sudo pip install --upgrade pip
    - sudo pip install spline
    script:
    - spline --tags=osx

  - name: "Windows (MSVC)"
    os: windows
    script:
    - cmd.exe /C '"C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Auxiliary\Build\vcvars64.bat" && build.bat'
    - test/cpp11_seq.exe
    - test/cpp11_par.exe
    - test/cpp14_seq.exe
    - test/cpp14_par.exe
    - test/cpp17_seq.exe
    - test/cpp17_par.exe

notifications:
    email:
        recipients:
           - jarthianur.github@gmail.com
        on_success: change
        on_failure: change
